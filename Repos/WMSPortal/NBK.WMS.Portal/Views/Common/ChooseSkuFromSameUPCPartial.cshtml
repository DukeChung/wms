@{
    Layout = null;
}



<link rel="stylesheet" type="text/css" href="~/Content/style.css" />
<link rel="stylesheet" type="text/css" href="~/Content/bootstrap.min.css" />

@Styles.Render("~/Content/plugins/dataTables/dataTablesStyles")
@*<link href="@Url.Content("~/Scripts/plugins/jquery-ui/jquery-ui.css")" rel="stylesheet" type="text/css" />*@


<div id="divChooseSkuFromSameUPC">
    <div class="ibox-content">
        <div class="row">
            <button id="btnChooseSku" class="btn btn-primary" type="button" style="margin-left:25px;float: left; ">选择并关闭</button>
        </div>
        <div class="row">
            <table id="gvChooseSkuFromSameUPC" class="table table-striped table-bordered table-hover dataTables-example">
                <thead>
                    <tr>
                        <th width="5%"></th>
                        <th data-data="SkuName">商品名称</th>
                        <th data-data="SkuDescr">商品描述</th>
                        <th data-data="UPC">UPC</th>
                        <th data-data="TypeDisplay">类型</th>
                        <th data-data="PackQty">包装数量</th>
                    </tr>
                </thead>
            </table>
        </div>
    </div>
</div>


@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")
@Scripts.Render("~/plugins/dataTables")
<script>
    var ChooseSkuFromSameUPCModel = {
        returnValue: {
            SkuSysId: null,
            UPC: null,
            Qty: null
        },
        table: {},
        init: function () {
            _self = this;
            _self.table = $('#gvChooseSkuFromSameUPC').DataTable({
                "sAjaxSource": "GetSkuListWithUPC",
                "fnServerParams": function (aoData) { //查询条件
                    var existsSkuSysId = parent.ChooseSkuModel.existsSkuSysId;
                    if (existsSkuSysId == null) {
                        existsSkuSysId = '';
                    }
                    aoData.push(
                        { "name": "UPC", "value": "@ViewBag.UPC" },
                        { "name": "SkuName", "value": "@ViewBag.skuName" },
                        { "name": "SkuCode", "value": "@ViewBag.skuCode" },
                        { "name": "ExcludeSkuSysIdString", "value": existsSkuSysId.toString() }
                    );
                },
                //dom: 'Bfrtip',
                buttons: [],
                "columnDefs": [
                    {
                        "targets": 0,
                        "width": "40px",
                        render: function (data, type, full, meta) {
                            return '<input type="radio" name="ChooseSku" value="' + full.SysId + '" upc="' + full.UPC + '" qty="' + full.PackQty + '"/>';
                        }
                    }
                ],
                "fnInfoCallback": function (oSettings, iStart, iEnd, iMax, iTotal, sPre) {
                    if (iTotal == 0) {
                        parent.ChooseSkuModel.existsSkuUPC = null;
                        parent.ChooseSkuModel.chooseSkuSysId = '';
                        parent.ChooseSkuModel.skuDialog.close('');
                    } else if (iTotal == 1) {
                        //如果只查询到一条记录，则直接添加到右边
                        var row = ChooseSkuFromSameUPCModel.table.rows().data();
                        parent.ChooseSkuModel.chooseSkuSysId = row[0].SysId;

                        ChooseSkuFromSameUPCModel.returnValue.SkuSysId = row[0].SysId;
                        ChooseSkuFromSameUPCModel.returnValue.UPC = row[0].UPC;
                        ChooseSkuFromSameUPCModel.returnValue.Qty = row[0].PackQty;
                        parent.ChooseSkuModel.existsSkuUPC = null;
                        parent.ChooseSkuModel.skuDialog.close(ChooseSkuFromSameUPCModel.returnValue).remove();
                    }
                },
                "bServerSide": true,
                "bProcessing": true,
                "bPaginate": false, //翻页功能
                "bLengthChange": true, //改变每页显示数据数量
                "bFilter": false, //过滤功能
                "bSort": false, //排序功能
                "bInfo": true, //页脚信息
                "bAutoWidth": true, //自动宽度
                "aaSorting": [[1, "Asc"]],
                "oLanguage": {
                    "sLengthMenu": "每页显示 _MENU_ 条记录",
                    "sInfo": "共 _TOTAL_ 条数据",
                    "sInfoEmpty": "",
                    "sInfoFiltered": "(从 _MAX_ 条数据中检索)",
                    "oPaginate": {
                        "sFirst": "首页",
                        "sPrevious": "前一页",
                        "sNext": "后一页",
                        "sLast": "尾页"
                    },
                    "sZeroRecords": "没有检索到数据"
                }
            });

            $("#btnChooseSku").bind("click", function () {
                var check = $("#gvChooseSkuFromSameUPC tbody input:checked");

                if (check.length === 0) {
                    alert("请在列表中勾选一项!");
                    return null;
                }

                var sysId = $(check).val();
                if (sysId != null) {
                    parent.ChooseSkuModel.chooseSkuSysId = sysId;

                    ChooseSkuFromSameUPCModel.returnValue.SkuSysId = sysId;
                    ChooseSkuFromSameUPCModel.returnValue.UPC = $(check).attr("upc");
                    ChooseSkuFromSameUPCModel.returnValue.Qty = $(check).attr("qty");

                    parent.ChooseSkuModel.skuDialog.close(ChooseSkuFromSameUPCModel.returnValue).remove();
                    //parent.ChooseSkuModel.skuDialog.remove();
                } else {
                    parent.ChooseSkuModel.existsSkuUPC = null;
                    parent.ChooseSkuModel.chooseSkuSysId = '';
                    parent.ChooseSkuModel.skuDialog.close().remove();
                }

            });
        }
    }

    $(function () {
        ChooseSkuFromSameUPCModel.init();
    })

</script>
