@using NBK.WMS.Portal.Helpers

@{
    ViewBag.Title = "货品单位编辑";
}

@Html.Breadcrumb("货品单位管理", "/PackageManage/UOMMaintain", "货品单位编辑")


<div class="wrapper wrapper-content animated fadeInRight ecommerce">
    <div id="editUOM" class="ibox-content m-b-sm border-bottom">
        <form id="uomForm" class="form-horizontal">
            <div class="form-group">
                <label class="col-sm-2 control-label">计量单位代码</label>

                <div class="col-sm-10"><input id="UOMCode" name="UOMCode" v-model="UOMCode" disabled="" type="text" class="form-control required" ></div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">计量单位描述</label>

                <div class="col-sm-10"><input id="Descr" name="Descr" v-model="Descr" type="text" class="form-control required" ></div>
            </div>

            <div class="form-group">
                <label class="col-sm-2 control-label">计量单位类型</label>

                <div class="col-sm-10">
                    <select class="form-control m-b" id="UomType" name="UomType" v-model="UomType">
                        @{
                            foreach (var uom in (List<SelectListItem>)ViewBag.UomList)
                            {
                                <option value="@uom.Value">@uom.Text</option>
                            }
                        }
                    </select>
                </div>
            </div>

            <div class="ibox-footer text-right tooltip-demo">
                <a class="btn btn-sm btn-primary" id="btnEditUOM"><i class="fa fa-check-square-o"></i> 保存</a>
                <a class="btn btn-white btn-sm" id="btnReturn"><i class="fa fa-times"></i> 返回</a>
            </div>
        </form>
    </div>
</div>
@section Styles {
    @Styles.Render("~/Content/plugins/iCheck/iCheckStyles")
    @Styles.Render("~/plugins/wizardStepsStyles")
}


@section Scripts {
    @Scripts.Render("~/plugins/wizardSteps")
    @Scripts.Render("~/plugins/iCheck")
    @Scripts.Render("~/plugins/validate")
    @Scripts.Render("~/plugins/validate/cnMessage")

    <script>
        var UOMEdit = {
            uomVue: {},
            init: function () {
                var _self = this;

                $.ajax({
                    url: "@Url.Action("GetUOMBySysId", "PackageManage")",
                    data:
                    {
                        'sysId': '@ViewBag.UOMSysId'
                    },
                    type: "GET",
                    success: function (data) {
                        if (data.success) {
                            _self.uomVue = new Vue({
                                el: '#editUOM',
                                data: data.UOM
                            });
                        }
                        else {
                            alert(data.message);
                        }
                    },
                    error: function () {
                        alert("数据获取失败！");
                    }
                });

                $("#uomForm").validate({
                    ignore: [],
                    rules: {
                        UomType: {
                            required: true
                        },
                        UOMCode: {
                            required: true,
                            maxlength: 32
                        },
                        Descr: {
                            required: true,
                            maxlength: 128
                        },
                    },
                    messages: {
                        UomType: {
                            required: "请选择"
                        }
                    }
                });

                $("#btnEditUOM").click(function () {

                    if ($("#uomForm").valid()) {
                        $.ajax({
                            url: "@Url.Action("UpdateUOM", "PackageManage")",
                            data: _self.uomVue.$data,
                            type: "post",
                            success: function (data) {
                                if (data.success) {
                                    msgSuccess("更新成功!");
                                    _self.backParentPage();
                                }
                                else {
                                    msgErro(data.message);
                                }
                            },
                            error: function () {
                                msgErro("操作失败！");
                            }
                        });
                    }
                })

                $("#btnReturn").click(function () {
                    _self.backParentPage();
                })

            },
            backParentPage: function () {
                window.location.href = '@Url.Action("UOMMaintain", "PackageManage")'
            }
        }

        $(function () {
            UOMEdit.init();
        })

    </script>
}